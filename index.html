<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0a0a0a" />
    <title>Hangboard Timer</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ========== CUSTOMIZE YOUR APP - CHANGE VALUES BELOW ========== */
      :root {
        /* COLORS - Use hex codes like #ff6b35 */
        --accent: #ff6b35; /* Orange accent (buttons, highlights) */
        --success: #4ade80; /* Green (completed exercises) */
        --rest: #3b82f6; /* Blue (rest phase) */
        --work: #ff6b35; /* Orange (work/hang phase) */
        --surface: #111; /* Dark background */
        --surface-alt: #1a1a1a; /* Slightly lighter background */
        --border: #2a2a2a; /* Border color */
        --text-dim: #777; /* Dimmer text/labels */

        /* TEXT SIZES - Regular (1rem = normal), Fullscreen (larger) */
        --header-font: 1.5rem; /* App title size */
        --exercise-title-font: 1.75rem; /* Exercise name size */
        --exercise-title-fullscreen: 2.5rem; /* Exercise name when fullscreen */
        --timer-font: 5rem; /* Timer numbers size */
        --timer-fullscreen: 5.5rem; /* Timer size when fullscreen */
        --tenths-font: 2.5rem; /* Decimal part of timer */
        --tenths-fullscreen: 2.75rem; /* Decimal when fullscreen */
        --grip-font: 1.1rem; /* Grip size text */
        --set-info-font: 1.5rem; /* "Set 1 of 5" text */
        --set-info-fullscreen: 1.4rem; /* Set info when fullscreen */
        --phase-font: 2.5rem; /* "HANG" / "REST" text */
        --phase-fullscreen: 2.5rem; /* Phase text when fullscreen */

        /* IMAGE SIZES */
        --image-width: 240px; /* Exercise image width */
        --image-height: 240px; /* Exercise image height */
        --image-border: 2px; /* Image border thickness */
        --image-fullscreen-width: 90%; /* Full screen image width */
        --image-fullscreen-height: 50vh; /* Full screen image height */
        --image-fullscreen-border: 3px; /* Full screen border thickness */
        --thumb-size: 50px; /* Small exercise thumbnail size */

        /* SPACING - WHERE THINGS ARE POSITIONED IN THE UI */
        /* Around the main timer box */
        --container-padding: 16px 5px; /* Space inside the main box (left/right, top/bottom) */
        --container-margin: 12px; /* Space below the main box before next element */

        /* Exercise title to image spacing */
        --space-title-to-image: 2px; /* Gap between exercise name and image */

        /* Image to next element spacing */
        --space-image-to-text: 8px; /* Gap below image to "Set 1 of 5" text */

        /* Between major sections */
        --space-sections: 8px; /* Gap between exercise info and timer display */

        /* Between timer and controls */
        --space-timer-to-controls: 8px; /* Gap between timer number and progress bar */

        /* General spacing */
        --gap-large: 8px; /* Large gap between elements */
        --gap-small: 4px; /* Small gap between elements */

        /* PROGRESS BAR */
        --progress-height: 8px; /* Progress bar thickness */
        --progress-fullscreen-height: 6px; /* Progress bar when fullscreen */

        /* ROUNDED CORNERS */
        --border-radius-large: 20px; /* Large rounded corners */
        --border-radius-medium: 12px; /* Medium rounded corners */
        --border-radius-small: 8px; /* Small rounded corners */
      }
      /* ========== END CUSTOMIZE ========== */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: "Space Grotesk", sans-serif;
        background: var(--surface);
        color: #f5f5f5;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .app {
        max-width: 480px;
        margin: 0 auto;
        padding: var(--container-padding) var(--container-padding) 100px;
      }

      .app.fullscreen {
        padding: var(--gap-small);
        padding-top: env(safe-area-inset-top, var(--gap-small));
        padding-bottom: env(safe-area-inset-bottom, var(--gap-small));
        display: flex;
        flex-direction: column;
        height: 100dvh;
        overflow: hidden;
      }

      .header {
        text-align: center;
        padding: 20px 0 var(--space-sections);
      }

      .header h1 {
        font-size: var(--header-font);
        font-weight: 700;
        letter-spacing: -0.02em;
      }

      .header p {
        color: var(--text-dim);
        font-size: 0.85rem;
      }

      .hidden {
        display: none !important;
      }

      .timer-container {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-large);
        padding: var(--container-padding);
        margin-bottom: var(--container-margin);
        text-align: center;
      }

      .timer-container.fullscreen-timer {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        margin-bottom: var(--gap-small);
        padding: var(--space-image-to-text);
        min-height: 0;
      }

      .timer-container.working {
        border-color: var(--work);
        box-shadow:
          0 0 60px rgba(255, 107, 53, 0.25),
          inset 0 0 60px rgba(255, 107, 53, 0.03);
      }

      .timer-container.resting {
        border-color: var(--rest);
        box-shadow:
          0 0 60px rgba(59, 130, 246, 0.25),
          inset 0 0 60px rgba(59, 130, 246, 0.03);
      }

      .timer-container.countdown-phase {
        border-color: var(--success);
        box-shadow:
          0 0 60px rgba(74, 222, 128, 0.25),
          inset 0 0 60px rgba(74, 222, 128, 0.03);
      }

      .timer-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        height: 100%;
      }

      .current-exercise {
        font-size: var(--exercise-title-font);
        font-weight: 700;
        margin-bottom: 2px;
      }

      .current-exercise.fullscreen-title {
        font-size: var(--exercise-title-fullscreen);
        margin-bottom: 2px;
        line-height: 1.1;
      }

      .grip-label {
        color: var(--text-dim);
        font-size: var(--grip-font);
        font-weight: 500;
        margin-bottom: var(--space-title-to-image);
      }

      .exercise-image {
        width: var(--image-width);
        height: var(--image-height);
        border-radius: var(--border-radius-medium);
        object-fit: cover;
        border: var(--image-border) solid var(--border);
        margin: 0 auto var(--space-image-to-text);
        display: block;
      }

      .exercise-image.fullscreen-image {
        width: var(--image-fullscreen-width);
        max-height: var(--image-fullscreen-height);
        margin: 0;
        border: var(--image-fullscreen-border) solid var(--border);
        flex-shrink: 0;
      }

      .set-info {
        font-size: var(--set-info-font);
        font-weight: 600;
        margin-bottom: var(--space-sections);
      }

      .set-info.fullscreen-set {
        font-size: var(--set-info-fullscreen);
        font-weight: 700;
        margin: var(--gap-small) 0 2px;
      }

      .phase-label {
        font-family: "JetBrains Mono", monospace;
        font-size: var(--phase-font);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        margin-bottom: var(--gap-small);
      }

      .phase-label.fullscreen-phase {
        font-size: var(--phase-fullscreen);
        margin-bottom: 0;
        letter-spacing: 0.2em;
      }

      .phase-label.work {
        color: var(--work);
      }

      .phase-label.rest {
        color: var(--rest);
      }

      .phase-label.countdown {
        color: var(--success);
      }

      .timer-display {
        font-family: "JetBrains Mono", monospace;
        font-size: var(--timer-font);
        font-weight: 700;
        line-height: 1;
        display: flex;
        justify-content: center;
        align-items: baseline;
        margin-bottom: var(--space-timer-to-controls);
      }

      .timer-display.fullscreen-time {
        font-size: var(--timer-fullscreen);
        margin: 0;
      }

      .timer-tenths {
        font-size: var(--tenths-font);
        font-weight: 400;
        color: var(--text-dim);
        margin-left: 4px;
      }

      .timer-tenths.fullscreen-tenths {
        font-size: var(--tenths-fullscreen);
        margin-left: 2px;
      }

      .progress-bar {
        height: var(--progress-height);
        background: var(--surface-alt);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: var(--space-sections);
        width: 100%;
      }

      .progress-bar.fullscreen-progress {
        height: var(--progress-fullscreen-height);
        margin: var(--gap-small) 0;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.05s linear;
      }

      .progress-fill.work {
        background: var(--work);
      }

      .progress-fill.rest {
        background: var(--rest);
      }

      .progress-fill.countdown {
        background: var(--success);
      }
      .overall-progress,
      .workout-time {
        color: var(--text-dim);
        font-size: 0.9rem;
      }

      .overall-progress.fullscreen-overall {
        font-size: 0.95rem;
      }

      .workout-time {
        font-size: 0.85rem;
        margin-top: var(--gap-small);
      }

      .controls {
        display: flex;
        gap: var(--gap-large);
        margin-bottom: var(--space-sections);
      }

      .controls.fullscreen-controls {
        margin-bottom: 0;
        flex-shrink: 0;
        gap: var(--gap-small);
      }

      .btn {
        flex: 1;
        padding: var(--space-image-to-text) 24px;
        border: none;
        border-radius: var(--border-radius-small);
        font-family: "Space Grotesk", sans-serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
      }

      .btn-primary:hover {
        filter: brightness(1.1);
      }

      .btn-primary:active {
        transform: scale(0.98);
      }

      .btn-secondary {
        background: var(--surface);
        color: #f5f5f5;
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--surface-alt);
      }

      .btn-danger {
        background: #dc2626;
        color: white;
      }

      .btn-skip {
        flex: 0.5;
        padding: var(--space-image-to-text) 12px;
        background: var(--surface);
        color: #f5f5f5;
        border: 1px solid var(--border);
        font-size: 1.25rem;
      }

      .btn-skip:active {
        background: var(--surface-alt);
        transform: scale(0.98);
      }

      .tabs {
        display: flex;
        gap: 0;
        margin-bottom: var(--container-margin);
        background: transparent;
        padding: 0;
        border-radius: 0;
        border-bottom: 1px solid var(--border);
      }

      .tab {
        flex: 1;
        padding: 12px 16px;
        border: none;
        border-radius: 0;
        background: transparent;
        color: var(--text-dim);
        font-family: "Space Grotesk", sans-serif;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
      }

      .tab.active {
        background: transparent;
        color: var(--accent);
        border-bottom-color: var(--accent);
      }

      .exercise-list {
        display: flex;
        flex-direction: column;
        gap: var(--gap-large);
      }

      .exercise-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-small);
        padding: var(--space-image-to-text);
        display: flex;
        gap: var(--gap-large);
        align-items: center;
        cursor: pointer;
      }

      .exercise-card.active {
        border-color: var(--accent);
      }

      .exercise-card.completed {
        opacity: 0.5;
      }

      .exercise-thumb {
        width: var(--thumb-size);
        height: var(--thumb-size);
        border-radius: var(--border-radius-small);
        object-fit: cover;
        background: var(--surface-alt);
        flex-shrink: 0;
      }

      .exercise-details {
        flex: 1;
        min-width: 0;
      }

      .exercise-name {
        font-weight: 600;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .exercise-meta {
        color: var(--text-dim);
        font-size: 0.8rem;
      }

      .exercise-status {
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 6px;
        background: var(--surface-alt);
        color: var(--text-dim);
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .exercise-status:hover {
        color: var(--accent);
        border-color: var(--accent);
      }

      .exercise-status.done {
        background: rgba(74, 222, 128, 0.1);
        color: var(--success);
      }

      .exercise-card.editable {
        justify-content: space-between;
      }

      .exercise-card.editable .exercise-details {
        flex: 1;
      }

      .exercise-move-buttons {
        display: flex;
        gap: var(--gap-small);
        flex-shrink: 0;
      }

      .move-btn {
        width: 32px;
        height: 32px;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: var(--border-radius-small);
        background: var(--surface-alt);
        color: var(--text-dim);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .move-btn:hover:not(:disabled) {
        color: var(--accent);
        border-color: var(--accent);
      }

      .move-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .settings-section {
        margin-bottom: var(--space-sections);
      }

      .settings-title {
        font-size: 0.85rem;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: var(--space-timer-to-controls);
      }

      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-timer-to-controls) 0;
        border-bottom: 1px solid var(--border);
      }

      .setting-label {
        font-weight: 500;
      }

      .setting-input {
        width: 80px;
        padding: var(--gap-small) 12px;
        border: 1px solid var(--border);
        border-radius: var(--border-radius-small);
        background: var(--surface);
        color: #f5f5f5;
        font-family: "JetBrains Mono", monospace;
        font-size: 1rem;
        text-align: center;
      }

      .setting-input:focus {
        outline: none;
        border-color: var(--accent);
      }

      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-sections);
        z-index: 100;
      }

      .modal {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-medium);
        width: 100%;
        max-width: 400px;
        max-height: 90vh;
        overflow-y: auto;
        padding: var(--space-sections);
      }

      .modal h2 {
        font-size: 1.25rem;
        margin-bottom: var(--space-sections);
      }

      .form-group {
        margin-bottom: var(--space-image-to-text);
      }

      .form-label {
        display: block;
        font-size: 0.85rem;
        color: var(--text-dim);
        margin-bottom: 6px;
      }

      .form-input {
        width: 100%;
        padding: var(--gap-small);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-small);
        background: var(--surface-alt);
        color: #f5f5f5;
        font-family: "Space Grotesk", sans-serif;
        font-size: 1rem;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--accent);
      }

      .image-upload {
        width: 100%;
        height: 120px;
        border: 2px dashed var(--border);
        border-radius: var(--border-radius-small);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .image-upload:hover {
        border-color: var(--accent);
      }

      .image-upload img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .image-upload-text {
        color: var(--text-dim);
        font-size: 0.85rem;
      }

      .modal-actions {
        display: flex;
        gap: var(--gap-large);
        margin-top: 24px;
      }

      .add-exercise-btn {
        width: 100%;
        padding: var(--space-image-to-text);
        border: 2px dashed var(--border);
        border-radius: var(--border-radius-small);
        background: transparent;
        color: var(--text-dim);
        font-family: "Space Grotesk", sans-serif;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 12px;
      }

      .add-exercise-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      @media (max-height: 700px) {
        .timer-display.fullscreen-time {
          font-size: 4.5rem;
        }
        .timer-tenths.fullscreen-tenths {
          font-size: 2.25rem;
        }
        .current-exercise.fullscreen-title {
          font-size: 1.5rem;
        }
        .set-info.fullscreen-set {
          font-size: 1.2rem;
        }
      }

      @media (min-height: 850px) {
        .timer-display.fullscreen-time {
          font-size: 6.5rem;
        }
        .timer-tenths.fullscreen-tenths {
          font-size: 3.25rem;
        }
        .current-exercise.fullscreen-title {
          font-size: 2.25rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;
      const defaultExercises = [
        { id: 1, name: "Half Crimp", grip: "20mm", sets: 5, image: null },
        { id: 2, name: "Full Crimp", grip: "25mm", sets: 5, image: null },
        { id: 3, name: "Open Hand", grip: "30mm", sets: 5, image: null },
        { id: 4, name: "Jug", grip: "45mm", sets: 5, image: null },
      ];
      function App() {
        const [exercises, setExercises] = useState(() => {
          const saved = localStorage.getItem("hangboard-exercises-v2");
          return saved ? JSON.parse(saved) : defaultExercises;
        });
        const [workTime, setWorkTime] = useState(10);
        const [restTime, setRestTime] = useState(20);
        const [isRunning, setIsRunning] = useState(false);
        const [isPaused, setIsPaused] = useState(false);
        const [currentExercise, setCurrentExercise] = useState(0);
        const [currentSet, setCurrentSet] = useState(1);
        const [phase, setPhase] = useState("countdown");
        const [timeLeft, setTimeLeft] = useState(5000);
        const [activeTab, setActiveTab] = useState("timer");
        const [editingExercise, setEditingExercise] = useState(null);
        useEffect(() => {
          localStorage.setItem(
            "hangboard-exercises-v2",
            JSON.stringify(exercises),
          );
        }, [exercises]);
        useEffect(() => {
          if (!isRunning || isPaused) return;
          const interval = setInterval(() => {
            setTimeLeft((t) => {
              if (t <= 100) return 0;
              return t - 100;
            });
          }, 100);
          return () => clearInterval(interval);
        }, [isRunning, isPaused]);
        useEffect(() => {
          if (timeLeft > 0 || !isRunning) return;
          if (phase === "countdown") {
            setPhase("work");
            setTimeLeft(workTime * 1000);
          } else if (phase === "work") {
            const isLastSet = currentSet >= exercises[currentExercise].sets;
            const isLastEx = currentExercise >= exercises.length - 1;
            if (isLastSet && isLastEx) {
              setIsRunning(false);
              return;
            }
            setPhase("rest");
            setTimeLeft(restTime * 1000);
          } else {
            const isLastSet = currentSet >= exercises[currentExercise].sets;
            if (isLastSet) {
              if (currentExercise >= exercises.length - 1) {
                setIsRunning(false);
                return;
              }
              setCurrentExercise((c) => c + 1);
              setCurrentSet(1);
            } else {
              setCurrentSet((c) => c + 1);
            }
            setPhase("work");
            setTimeLeft(workTime * 1000);
          }
        }, [
          isRunning,
          timeLeft,
          phase,
          currentExercise,
          currentSet,
          workTime,
          restTime,
          exercises,
        ]);
        const startWorkout = () => {
          setIsRunning(true);
          setIsPaused(false);
          setCurrentExercise(0);
          setCurrentSet(1);
          setPhase("countdown");
          setTimeLeft(5000);
        };
        const stopWorkout = () => {
          setIsRunning(false);
          setIsPaused(false);
          setTimeLeft(0);
        };
        const togglePause = () => setIsPaused(!isPaused);
        const skipForward = () => {
          if (phase === "countdown") {
            setPhase("work");
            setTimeLeft(workTime * 1000);
          } else if (phase === "work") {
            const isLastSet = currentSet >= exercises[currentExercise].sets;
            const isLastEx = currentExercise >= exercises.length - 1;
            if (isLastSet && isLastEx) {
              setIsRunning(false);
              setTimeLeft(0);
              return;
            }
            setPhase("rest");
            setTimeLeft(restTime * 1000);
          } else {
            const isLastSet = currentSet >= exercises[currentExercise].sets;
            if (isLastSet) {
              if (currentExercise >= exercises.length - 1) {
                setIsRunning(false);
                setTimeLeft(0);
                return;
              }
              setCurrentExercise((c) => c + 1);
              setCurrentSet(1);
            } else {
              setCurrentSet((c) => c + 1);
            }
            setPhase("work");
            setTimeLeft(workTime * 1000);
          }
        };
        const skipBackward = () => {
          if (phase === "countdown") {
            setTimeLeft(5000);
          } else if (phase === "rest") {
            setPhase("work");
            setTimeLeft(workTime * 1000);
          } else {
            if (currentSet > 1) {
              setCurrentSet((c) => c - 1);
              setPhase("rest");
              setTimeLeft(restTime * 1000);
            } else if (currentExercise > 0) {
              setCurrentExercise((c) => c - 1);
              setCurrentSet(exercises[currentExercise - 1].sets);
              setPhase("rest");
              setTimeLeft(restTime * 1000);
            } else {
              setPhase("countdown");
              setTimeLeft(5000);
            }
          }
        };
        const getTotalSets = () => exercises.reduce((s, e) => s + e.sets, 0);
        const getCompletedSets = () => {
          let c = 0;
          for (let i = 0; i < currentExercise; i++) c += exercises[i].sets;
          c += currentSet - 1;
          if (phase === "rest") c += 1;
          return c;
        };
        const getProgress = () => {
          const t =
            phase === "countdown"
              ? 5000
              : (phase === "work" ? workTime : restTime) * 1000;
          return ((t - timeLeft) / t) * 100;
        };
        const formatSeconds = (m) => Math.ceil(m / 1000);
        const formatTenths = (m) => Math.floor((m % 1000) / 100);
        const getTotalWorkoutTime = () => {
          const ts = getTotalSets();
          const minsec = ts * workTime + (ts - 1) * restTime;
          const mins = Math.floor(minsec / 60);
          const secs = minsec % 60;
          return `${mins}:${secs.toString().padStart(2, "0")}`;
        };
        const handleImageUpload = (exId, e) => {
          const f = e.target.files[0];
          if (f) {
            const r = new FileReader();
            r.onloadend = () => {
              setExercises((prev) =>
                prev.map((ex) =>
                  ex.id === exId ? { ...ex, image: r.result } : ex,
                ),
              );
            };
            r.readAsDataURL(f);
          }
        };
        const updateExercise = (exId, u) => {
          setExercises((prev) =>
            prev.map((ex) => (ex.id === exId ? { ...ex, ...u } : ex)),
          );
        };
        const deleteExercise = (exId) => {
          setExercises((prev) => prev.filter((ex) => ex.id !== exId));
          setEditingExercise(null);
        };
        const moveExercise = (exId, direction) => {
          setExercises((prev) => {
            const idx = prev.findIndex((ex) => ex.id === exId);
            if (idx === -1) return prev;
            const newExercises = [...prev];
            if (direction === "up" && idx > 0) {
              [newExercises[idx], newExercises[idx - 1]] = [
                newExercises[idx - 1],
                newExercises[idx],
              ];
            } else if (direction === "down" && idx < newExercises.length - 1) {
              [newExercises[idx], newExercises[idx + 1]] = [
                newExercises[idx + 1],
                newExercises[idx],
              ];
            }
            return newExercises;
          });
        };
        const addExercise = () => {
          const nId = Math.max(...exercises.map((e) => e.id), 0) + 1;
          setExercises((prev) => [
            ...prev,
            {
              id: nId,
              name: "New Exercise",
              grip: "20mm",
              sets: 2,
              image: null,
            },
          ]);
        };
        const isLastSetOfExercise = () =>
          currentSet >= exercises[currentExercise]?.sets;
        const isFinalRest = () => phase === "rest" && isLastSetOfExercise();
        const getNextExerciseIndex = () => {
          if (currentExercise < exercises.length - 1) {
            return currentExercise + 1;
          }
          return null;
        };
        const getDisplayExerciseIndex = () => {
          return isFinalRest() && getNextExerciseIndex() !== null
            ? getNextExerciseIndex()
            : currentExercise;
        };
        const getDisplaySetInfo = () => {
          if (isFinalRest() && getNextExerciseIndex() !== null) {
            return "GET READY";
          }
          return `Set ${currentSet} of ${exercises[currentExercise]?.sets}`;
        };
        const isActiveTimer = isRunning && !isPaused;
        const renderFullscreenTimer = () => {
          const cc =
            phase === "countdown"
              ? "countdown-phase"
              : phase === "work"
                ? "working"
                : "resting";
          const displayExIdx = getDisplayExerciseIndex();
          return (
            <div className={`timer-container fullscreen-timer ${cc}`}>
              <div className="timer-content">
                <div className="current-exercise fullscreen-title">
                  {exercises[displayExIdx]?.name}
                </div>
                <div className="grip-label fullscreen-grip">
                  {exercises[displayExIdx]?.grip}
                </div>
                {exercises[displayExIdx]?.image && (
                  <img
                    src={exercises[displayExIdx].image}
                    className="exercise-image fullscreen-image"
                  />
                )}
                <div className="set-info fullscreen-set">
                  {isFinalRest() && getNextExerciseIndex() !== null
                    ? "GET READY"
                    : `Set ${currentSet} of ${exercises[currentExercise]?.sets}`}
                </div>
                <div className={`phase-label fullscreen-phase ${phase}`}>
                  {phase === "countdown"
                    ? "GET READY"
                    : phase === "work"
                      ? "HANG"
                      : "REST"}
                </div>
                <div className="timer-display fullscreen-time">
                  <span>{formatSeconds(timeLeft)}</span>
                  <span className="timer-tenths fullscreen-tenths">
                    .{formatTenths(timeLeft)}
                  </span>
                </div>
                <div className="progress-bar fullscreen-progress">
                  <div
                    className={`progress-fill ${phase}`}
                    style={{ width: `${getProgress()}%` }}
                  />
                </div>
                <div className="overall-progress fullscreen-overall">
                  {getCompletedSets()}/{getTotalSets()} sets complete
                </div>
              </div>
            </div>
          );
        };
        return (
          <div className={`app ${isActiveTimer ? "fullscreen" : ""}`}>
            <div className={`header ${isActiveTimer ? "hidden" : ""}`}>
              <h1>Hangboard Timer</h1>
              <p>
                40% max · {workTime}s work · {restTime}s rest
              </p>
            </div>
            <div className={`tabs ${isActiveTimer ? "hidden" : ""}`}>
              <button
                className={`tab ${activeTab === "timer" ? "active" : ""}`}
                onClick={() => setActiveTab("timer")}
              >
                Timer
              </button>
              <button
                className={`tab ${activeTab === "exercises" ? "active" : ""}`}
                onClick={() => setActiveTab("exercises")}
              >
                Exercises
              </button>
              <button
                className={`tab ${activeTab === "settings" ? "active" : ""}`}
                onClick={() => setActiveTab("settings")}
              >
                Settings
              </button>
            </div>
            {activeTab === "timer" && (
              <>
                {isActiveTimer ? (
                  renderFullscreenTimer()
                ) : (
                  <div
                    className={`timer-container ${isRunning ? (phase === "work" ? "working" : "resting") : ""}`}
                  >
                    <div className="current-exercise">
                      {isRunning
                        ? exercises[getDisplayExerciseIndex()]?.name
                        : "Ready"}
                    </div>
                    {isRunning &&
                      exercises[getDisplayExerciseIndex()]?.image && (
                        <img
                          src={exercises[getDisplayExerciseIndex()].image}
                          className="exercise-image"
                        />
                      )}
                    <div className="set-info">
                      {isRunning ? (
                        <>
                          {isFinalRest() && getNextExerciseIndex() !== null
                            ? "GET READY"
                            : `Set ${currentSet} of ${exercises[currentExercise]?.sets}`}
                        </>
                      ) : (
                        `${exercises.length} exercises · ${getTotalSets()} total sets`
                      )}
                    </div>
                    <div className={`phase-label ${phase}`}>
                      {isRunning
                        ? phase === "work"
                          ? "HANG"
                          : "REST"
                        : "READY"}
                    </div>
                    <div className="timer-display">
                      <span>{formatSeconds(timeLeft)}</span>
                      <span className="timer-tenths">
                        .{formatTenths(timeLeft)}
                      </span>
                    </div>
                    {isRunning && (
                      <div className="progress-bar">
                        <div
                          className={`progress-fill ${phase}`}
                          style={{ width: `${getProgress()}%` }}
                        />
                      </div>
                    )}
                    <div className="overall-progress">
                      {isRunning
                        ? `${getCompletedSets()}/${getTotalSets()} sets complete`
                        : "Tap Start to begin"}
                    </div>
                    {!isRunning && (
                      <div className="workout-time">
                        Total time: {getTotalWorkoutTime()}
                      </div>
                    )}
                  </div>
                )}
                <div
                  className={`controls ${isActiveTimer ? "fullscreen-controls" : ""}`}
                >
                  {!isRunning ? (
                    <button className="btn btn-primary" onClick={startWorkout}>
                      Start Workout
                    </button>
                  ) : (
                    <>
                      <button className="btn btn-skip" onClick={skipBackward}>
                        ⏮
                      </button>
                      <button
                        className="btn btn-secondary"
                        onClick={togglePause}
                      >
                        {isPaused ? "Resume" : "Pause"}
                      </button>
                      <button className="btn btn-danger" onClick={stopWorkout}>
                        Stop
                      </button>
                      <button className="btn btn-skip" onClick={skipForward}>
                        ⏭
                      </button>
                    </>
                  )}
                </div>
                <div
                  className={`exercise-list ${isActiveTimer ? "hidden" : ""}`}
                >
                  {exercises.map((ex, i) => (
                    <div
                      key={ex.id}
                      className={`exercise-card ${isRunning && i === currentExercise ? "active" : ""} ${isRunning && i < currentExercise ? "completed" : ""}`}
                    >
                      {ex.image && (
                        <img src={ex.image} className="exercise-thumb" />
                      )}
                      <div className="exercise-details">
                        <div className="exercise-name">{ex.name}</div>
                        <div className="exercise-meta">
                          {ex.sets} sets · {ex.grip}
                        </div>
                      </div>
                      {isRunning && (
                        <div
                          className={`exercise-status ${i < currentExercise ? "done" : ""}`}
                        >
                          {i < currentExercise
                            ? "✓ Done"
                            : i === currentExercise
                              ? `${currentSet}/${ex.sets}`
                              : "Pending"}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </>
            )}
            {activeTab === "exercises" && (
              <>
                <div className="exercise-list">
                  {exercises.map((ex, idx) => (
                    <div key={ex.id} className="exercise-card editable">
                      {ex.image && (
                        <img src={ex.image} className="exercise-thumb" />
                      )}
                      <div
                        className="exercise-details"
                        onClick={() => setEditingExercise(ex)}
                      >
                        <div className="exercise-name">{ex.name}</div>
                        <div className="exercise-meta">
                          {ex.sets} sets · {ex.grip}
                        </div>
                      </div>
                      <div className="exercise-move-buttons">
                        <button
                          className="move-btn"
                          onClick={() => moveExercise(ex.id, "up")}
                          disabled={idx === 0}
                          title="Move up"
                        >
                          ↑
                        </button>
                        <button
                          className="move-btn"
                          onClick={() => moveExercise(ex.id, "down")}
                          disabled={idx === exercises.length - 1}
                          title="Move down"
                        >
                          ↓
                        </button>
                        <button
                          className="exercise-status"
                          onClick={() => setEditingExercise(ex)}
                        >
                          Edit →
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
                <button className="add-exercise-btn" onClick={addExercise}>
                  + Add Exercise
                </button>
              </>
            )}
            {activeTab === "settings" && (
              <>
                <div className="settings-section">
                  <div className="settings-title">Timer Settings</div>
                  <div className="setting-row">
                    <span className="setting-label">Work Time (seconds)</span>
                    <input
                      type="number"
                      className="setting-input"
                      value={workTime}
                      onChange={(e) =>
                        setWorkTime(Math.max(1, parseInt(e.target.value) || 1))
                      }
                      min="1"
                    />
                  </div>
                  <div className="setting-row">
                    <span className="setting-label">Rest Time (seconds)</span>
                    <input
                      type="number"
                      className="setting-input"
                      value={restTime}
                      onChange={(e) =>
                        setRestTime(Math.max(1, parseInt(e.target.value) || 1))
                      }
                      min="1"
                    />
                  </div>
                </div>
                <div className="settings-section">
                  <div className="settings-title">Reset</div>
                  <button
                    className="btn btn-secondary"
                    style={{ width: "100%" }}
                    onClick={() => {
                      if (confirm("Reset all exercises to defaults?")) {
                        setExercises(defaultExercises);
                        localStorage.removeItem("hangboard-exercises-v2");
                        setWorkTime(10);
                        setRestTime(20);
                      }
                    }}
                  >
                    Reset to Defaults
                  </button>
                </div>
              </>
            )}
            {editingExercise && (
              <div
                className="modal-overlay"
                onClick={() => setEditingExercise(null)}
              >
                <div className="modal" onClick={(e) => e.stopPropagation()}>
                  <h2>Edit Exercise</h2>
                  <div className="form-group">
                    <label className="form-label">Exercise Name</label>
                    <input
                      type="text"
                      className="form-input"
                      value={editingExercise.name}
                      onChange={(e) => {
                        const n = e.target.value;
                        setEditingExercise((prev) => ({ ...prev, name: n }));
                        updateExercise(editingExercise.id, { name: n });
                      }}
                    />
                  </div>
                  <div className="form-group">
                    <label className="form-label">Grip Size</label>
                    <input
                      type="text"
                      className="form-input"
                      value={editingExercise.grip}
                      onChange={(e) => {
                        const g = e.target.value;
                        setEditingExercise((prev) => ({ ...prev, grip: g }));
                        updateExercise(editingExercise.id, { grip: g });
                      }}
                    />
                  </div>
                  <div className="form-group">
                    <label className="form-label">Number of Sets</label>
                    <input
                      type="number"
                      className="form-input"
                      value={editingExercise.sets}
                      min="1"
                      onChange={(e) => {
                        const s = Math.max(1, parseInt(e.target.value) || 1);
                        setEditingExercise((prev) => ({ ...prev, sets: s }));
                        updateExercise(editingExercise.id, { sets: s });
                      }}
                    />
                  </div>
                  <div className="form-group">
                    <label className="form-label">Exercise Image</label>
                    <label className="image-upload">
                      {editingExercise.image ? (
                        <img src={editingExercise.image} />
                      ) : (
                        <span className="image-upload-text">
                          Tap to upload image
                        </span>
                      )}
                      <input
                        type="file"
                        accept="image/*"
                        style={{ display: "none" }}
                        onChange={(e) => {
                          handleImageUpload(editingExercise.id, e);
                          const f = e.target.files[0];
                          if (f) {
                            const r = new FileReader();
                            r.onloadend = () => {
                              setEditingExercise((prev) => ({
                                ...prev,
                                image: r.result,
                              }));
                            };
                            r.readAsDataURL(f);
                          }
                        }}
                      />
                    </label>
                  </div>
                  <div className="modal-actions">
                    <button
                      className="btn btn-danger"
                      onClick={() => deleteExercise(editingExercise.id)}
                    >
                      Delete
                    </button>
                    <button
                      className="btn btn-primary"
                      onClick={() => setEditingExercise(null)}
                    >
                      Done
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }
      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
